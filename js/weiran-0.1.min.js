/* Copyright (c) 2011-2011 by Tian Yantao 
 * Thanks OpenLayers and jQeury.
 *///=============================================================
// Weiran Observing System Framework
//-------------------------------------------------------------
// Global namespace
var Weiran={};Weiran.VERSION_NUMBER="0.1",Weiran.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return b.indexOf("opera")!=-1?a="opera":b.indexOf("msie")!=-1?a="msie":b.indexOf("safari")!=-1?a="safari":b.indexOf("mozilla")!=-1&&(b.indexOf("firefox")!=-1?a="firefox":a="mozilla"),a}(),Weiran.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("webkit")==-1&&a.indexOf("gecko")!=-1}(),Weiran.theOS=null,Weiran.imagePath="",Weiran.lastSeqID=0,Weiran.createUniqueID=function(a){return a==null&&(a="weID_"),Weiran.lastSeqID+=1,a+Weiran.lastSeqID},Weiran.getScriptLocation=function(a){var b,c,d,e,f="";typeof a=="string"?b=new RegExp("(^|(.*?\\/))("+a+")(\\?|$)"):b=new RegExp("(^|(.*?\\/))(weiran-"+Weiran.VERSION_NUMBER+".min.js)(\\?|$)"),c=document.getElementsByTagName("script");for(var g=0,h=c.length;g<h;g++){d=c[g].getAttribute("src");if(d){var e=d.match(b);if(e){f=e[1];break}}}return f},Weiran.getElement=function(){var a=[];for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];typeof d=="string"&&(d=document.getElementById(d));if(arguments.length==1)return d;a.push(d)}return a},Weiran.getStyle=function(a,b){a=Weiran.getElement(a);var c=null;if(a&&a.style){c=a.style[Weiran.String.camelize(b)];if(!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[Weiran.String.camelize(b)]);var e=["left","top","right","bottom"];window.opera&&Weiran.indexOf(e,b)!=-1&&Weiran.getStyle(a,"position")=="static"&&(c="auto")}return c=="auto"?null:c},Weiran.getViewportElement=function(){var a=arguments.callee.viewportElement;return a==undefined&&(a=Weiran.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement,arguments.callee.viewportElement=a),a},Weiran.pagePosition=function(a){var b=[0,0],c=Weiran.getViewportElement();if(!a||a==window||a==c)return b;var d=Weiran.IS_GECKO&&document.getBoxObjectFor&&Weiran.getStyle(a,"position")=="absolute"&&(a.style.top==""||a.style.left==""),e=null,f;if(a.getBoundingClientRect){f=a.getBoundingClientRect();var g=c.scrollTop,h=c.scrollLeft;b[0]=f.left+h,b[1]=f.top+g}else if(document.getBoxObjectFor&&!d){f=document.getBoxObjectFor(a);var i=document.getBoxObjectFor(c);b[0]=f.screenX-i.screenX,b[1]=f.screenY-i.screenY}else{b[0]=a.offsetLeft,b[1]=a.offsetTop,e=a.offsetParent;if(e!=a)while(e)b[0]+=e.offsetLeft,b[1]+=e.offsetTop,e=e.offsetParent;var j=Weiran.BROWSER_NAME;if(j=="opera"||j=="safari"&&Weiran.getStyle(a,"position")=="absolute")b[1]-=document.body.offsetTop;e=a.offsetParent;while(e&&e!=document.body){b[0]-=e.scrollLeft;if(j!="opera"||e.tagName!="TR")b[1]-=e.scrollTop;e=e.offsetParent}}return b},Weiran.indexOf=function(a,b){if(typeof a.indexOf=="function")return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1},Weiran.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},Weiran.extend=function(a,b){a=a||{};if(b){for(var c in b){var d=b[c];d!==undefined&&(a[c]=d)}var e=typeof window.Event=="function"&&b instanceof window.Event;!e&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},Weiran.applyDefaults=function(a,b){a=a||{};var c=typeof window.Event=="function"&&b instanceof window.Event;for(var d in b)if(a[d]===undefined||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))a[d]=b[d];return!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},Weiran.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,f;for(d=2,e=arguments.length;d<e;d++)f=arguments[d],typeof f=="function"&&(f=f.prototype),Weiran.extend(a.prototype,f)},Weiran.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d=typeof c.initialize=="function"?c.initialize:function(){b.apply(this,arguments)};if(a>1){var e=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c);Weiran.inherit.apply(null,e)}else d.prototype=c;return d},Weiran.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Weiran.String={startsWith:function(a,b){return a.indexOf(b)==0},contains:function(a,b){return a.indexOf(b)!=-1},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){var b=a.split("-"),c=b[0];for(var d=1,e=b.length;d<e;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){b||(b=window);var d=function(a,d){var e,f=d.split(/\.+/);for(var g=0;g<f.length;g++)g==0&&(e=b),e=e[f[g]];return typeof e=="function"&&(e=c?e.apply(null,c):e()),typeof e=="undefined"?"undefined":e};return a.replace(Weiran.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return Weiran.String.numberRegEx.test(a)},numericIf:function(a){return Weiran.String.isNumeric(a)?parseFloat(a):a}},Weiran.Lang={code:null,defaultCode:"en",getCode:function(){return Weiran.Lang.code||Weiran.Lang.setCode(),Weiran.Lang.code},setCode:function(a){var b;a||(a=Weiran.BROWSER_NAME=="msie"?navigator.userLanguage:navigator.language);var c=a.split("-");c[0]=c[0].toLowerCase(),typeof Weiran.Lang[c[0]]=="object"&&(b=c[0]);if(c[1]){var d=c[0]+"-"+c[1].toUpperCase();typeof Weiran.Lang[d]=="object"&&(b=d)}b||(b=Weiran.Lang.defaultCode),Weiran.Lang.code=b},translate:function(a){var b=Weiran.Lang[Weiran.Lang.getCode()],c=b&&b[a];return c||(c=a),c},add:function(a,b,c){return!a||!b||!c?!1:(typeof Weiran.Lang[a]!="object"&&(Weiran.Lang[a]={}),typeof Weiran.Lang[a][b]=="string"?!1:(Weiran.Lang[a][b]=c,!0))}},Weiran.i18n=Weiran.Lang.translate,Weiran.loadJsFile=function(a,b){if(!a||!b)return;var c=a.createElement("script");c.src=b,a.getElementsByTagName("head")[0].appendChild(c),c=null},Weiran.loadCssFile=function(a,b){if(!a||!b)return;var c=a.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=b,a.getElementsByTagName("head")[0].appendChild(c),c=null},Weiran.removeJsFile=function(a,b){if(!a||!b)return;var c=a.getElementsByTagName("script");for(var d=c.length;d>=0;d--)c[d]&&c[d].src!=null&&c[d].src.indexOf(b)!=-1&&c[d].parentNode.removeChild(c[d]);c=null},Weiran.romveCssFile=function(a,b){if(!a||!b)return;var c=a.getElementsByTagName("link");for(var d=c.length;d>=0;d--)c[d]&&c[d].href!=null&&c[d].href.indexOf(b)!=-1&&c[d].parentNode.removeChild(c[d]);c=null},Weiran.replaceJsFile=function(a,b,c){if(!a||!b||!c)return;var d=a.getElementsByTagName("script");for(var e=d.length;e>=0;e--)if(d[e]&&d[e].src!=null&&d[e].src.indexOf(b)!=-1){var f=a.createElement("script");f.src=c,d[e].parentNode.replaceChild(f,d[e]),f=null}d=null},Weiran.replaceCssFile=function(a,b,c){if(!a||!b||!c)return;var d=a.getElementsByTagName("link");for(var e=d.length;e>=0;e--)if(d[e]&&d[e].href!=null&&d[e].href.indexOf(b)!=-1){var f=a.createElement("link");f.type="text/css",f.rel="stylesheet",f.href=c,d[e].parentNode.replaceChild(f,d[e]),f=null}d=null},Weiran.require=function(a,b,c){if(typeof b!="object"){typeof c=="function"&&c("error");return}var d=0,e=function(){d+=1,d==b.length&&c()};for(var f=0,g=b.length;f<g;f++)if(typeof b[f]=="string"){var h=a.createElement("script");h.type="text/javascript",h.charset="utf-8",h.onload=e,h.src=b[f],a.getElementsByTagName("head")[0].appendChild(h)}},function(){var a=document.getElementById("weiran"),b="http://jpp.googlecode.com/svn/",c="js/";a&&(a.style.background="#F0FFFF url('./loading.gif') no-repeat center"),Weiran.require(document,[b+"jquery/jquery-1.7.1.min.js",b+"openlayers/openlayers-2.11.min.js",b+"jwim/jwim-0.5.min.js",b+"socket.io/io-0.8.7.min.js"],function(){a&&(a.style.backgroundColor="#E0F0F0"),Weiran.require(document,[b+"jquery/plugins/jquery.md5-1.2.1.min.js",b+"jquery/plugins/jquery.cookies-2.2.0.min.js",c+"olstk-0.1.min.js"],function(){a&&(a.style.backgroundColor="#D0E0E0"),Weiran.require(document,[c+"weos-0.1.min.js"],function(){a&&(a.style.backgroundColor="#B5D0D0",a.style.backgroundImage="");var b=new Weiran.OS("weiran","http://fanghuanweiran.com:2080/");b.boot(),b.getMainPanel().addApp(new Weiran.App({title:{en:"Layer Switcher","zh-CN":"图层切换"},iconurl:"apps/layerswitcher/icon.png",windowurl:"apps/layerswitcher/index.html"})),b.getMainPanel().addApp(new Weiran.App({title:{en:"LonLat Picker","zh-CN":"点取坐标"},iconurl:"apps/llpicker/icon.png",windowurl:"apps/llpicker/index.html"})),b.getMainPanel().addApp(new Weiran.App({title:{en:"iWhere","zh-CN":"我在哪里"},iconurl:"apps/iwhere/icon.png",windowurl:"apps/iwhere/index.html"})),b.getMainPanel().addApp(new Weiran.App({title:{en:"Measuring Tools","zh-CN":"测量工具"},iconurl:"apps/measure/icon.png",windowurl:"apps/measure/index.html"})),b.getMap().addLayers([new OpenLayers.Layer.WeWXRain,new OpenLayers.Layer.WeWXTemperature,new OpenLayers.Layer.WeWXWind,new OpenLayers.Layer.WeWXWaveHeight,new OpenLayers.Layer.WeWXCloudIR])})})})}();