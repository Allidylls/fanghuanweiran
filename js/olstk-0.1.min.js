/*
  Weiran OpenLayers Toolkits
  Copyright 2011-2011 Tian Yantao (yantaotian@foxmail.com).
*/OpenLayers.WeTextIcon=OpenLayers.Class({id:null,text:null,size:null,autoResize:!0,offset:null,calculateOffset:null,textDiv:null,px:null,initialize:function(a,b,c,d){this.text=a?a:"",this.size=b?b:new OpenLayers.Size(128,16),this.offset=c?c:new OpenLayers.Pixel(0,-(this.size.h/2)),this.calculateOffset=d;var e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.textDiv=OpenLayers.Util.createDiv(e,null,this.size),this.textDiv.className="olWeTextIcon",this.textDiv.innerHTML=this.text,this.autoResize&&(this.textDiv.style.height="",this.textDiv.style.width="")},destroy:function(){this.erase(),this.textDiv.innerHTML="",this.textDiv=null},clone:function(){return new OpenLayers.WeTextIcon(this.text,this.size,this.offset,this.calculateOffset)},setSize:function(a){a!=null&&(this.size=a),this.draw()},setText:function(a){a!==null&&(this.text=a,this.textDiv.innerHTML=this.text,this.autoResize&&(this.textDiv.style.height="",this.textDiv.style.width=""))},draw:function(a){return OpenLayers.Util.modifyDOMElement(this.textDiv,null,null,this.size,"absolute","none","none",1),this.moveTo(a),this.autoResize&&(this.textDiv.style.height="",this.textDiv.style.width=""),this.textDiv},erase:function(){this.textDiv!=null&&this.textDiv.parentNode!=null&&OpenLayers.Element.remove(this.textDiv)},setOpacity:function(a){OpenLayers.Util.modifyDOMElement(this.textDiv,null,null,null,null,null,null,a)},setColor:function(a){a&&(this.textDiv.style.color=a)},setAlign:function(a){a&&(this.textDiv.style.textAlign=a)},moveTo:function(a){a!=null&&(this.px=a);if(this.textDiv!=null)if(this.px==null)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));var b=this.px.offset(this.offset);OpenLayers.Util.modifyDOMElement(this.textDiv,null,b)}},display:function(a){this.textDiv.style.display=a?"":"none"},isDrawn:function(){var a=this.textDiv&&this.textDiv.parentNode&&this.textDiv.parentNode.nodeType!=11;return a},CLASS_NAME:"OpenLayers.WeTextIcon"}),OpenLayers.WeTextMarker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.WeTextMarker.defaultTextIcon();this.icon==null?this.icon=c:(this.icon.text=c.text,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.textDiv,null)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,this.icon!=null&&(this.icon.destroy(),this.icon=null)},draw:function(a){return this.icon.draw(a)},erase:function(){this.icon!=null&&this.icon.erase()},moveTo:function(a){a!=null&&this.icon!=null&&this.icon.moveTo(a),this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=this.icon&&this.icon.isDrawn();return a},onScreen:function(){var a=!1;if(this.map){var b=this.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},inflate:function(a){if(this.icon){var b=new OpenLayers.Size(this.icon.size.w*a,this.icon.size.h*a);this.icon.setSize(b)}},setOpacity:function(a){this.icon.setOpacity(a)},setText:function(a){this.icon.setText(a)},setColor:function(a){this.icon.setColor(a)},setAlign:function(a){this.icon.setAlign(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.WeTextMarker"}),OpenLayers.WeTextMarker.defaultTextIcon=function(){var a=OpenLayers.i18n("WeTextIcon"),b=new OpenLayers.Size(96,16),c=function(a){return new OpenLayers.Pixel(0,-(a.h/2))};return new OpenLayers.WeTextIcon(a,b,null,c)},OpenLayers.WeMarker=OpenLayers.Class({id:null,div:null,title:null,iconUrl:null,lonlat:null,marker:null,markerSize:null,textMarker:null,layer:null,map:null,vibrateTimer:null,showWindow:!1,window:null,windowUrl:null,windowFramed:!1,windowOpened:!1,dragable:!1,dragHandler:null,dragInterval:30,documentDrag:!1,bFirstDraw:!0,initialize:function(a){this.title=a&&a.title?a.title:"",this.lonlat=a&&a.lon&&a.lat?new OpenLayers.LonLat(a.lon,a.lat):new OpenLayers.LonLat(0,0),this.iconUrl=a&&a.iconurl?a.iconurl:OpenLayers.Util.getImagesLocation()+"marker_icon_default.png",this.windowUrl=a&&a.windowurl?a.windowurl:"",this.windowFramed=a&&a.windowframed?!0:!1,this.showWindow=a&&a.showWindow?!0:!1,this.dragable=a&&a.dragable?!0:!1,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id,null,null),this.div.className="olWeMarker",this.windowOpened=!1,this.bFirstDraw=!0},destroy:function(){this.vibrateTimer&&(clearInterval(this.vibrateTimer),this.vibrateTimer=null),this.marker!=null&&(this.marker.destroy(),this.marker=null),this.textMarker!=null&&(this.textMarker.destroy(),this.textMarker=null),this.windowOpened&&this.window!=null&&(this.window.close(),this.window=null,this.windowOpened=!1),this.dragHandler!=null&&(this.dragHandler.destroy(),this.dragHandler=null),this.div=null,this.layer=null,this.lonlat=null,this.map=null,this.markerSize=null},onScreen:function(){var a=!1;if(this.layer!=null&&this.layer.map!=null){var b=this.layer.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},onFirstDraw:function(){this.lonlat&&this.lonlat.transform(this.layer.projection,this.map.getProjectionObject())},createMarker:function(){return this.lonlat!=null&&(this.marker=new OpenLayers.Marker(this.lonlat,OpenLayers.WeMarker.defaultIcon(this.iconUrl)),this.showWindow&&(this.marker.events.register("click",this,this.onClick),this.marker.icon.imageDiv.style.cursor="pointer"),this.markerSize=this.marker.icon.size.clone(),this.dragable&&(this.dragHandler=new OpenLayers.Handler.Drag(this,{move:this.onDrag,done:this.onDragDone},{map:this.map,interval:this.dragInterval,documentDrag:this.documentDrag}),this.marker.events.register("dblclick",this,this.onDoubleClick))),this.marker},createTextMarker:function(){return this.lonlat!=null&&(this.textMarker=new OpenLayers.WeTextMarker(this.lonlat,OpenLayers.WeMarker.defaultTextIcon(this.title)),this.showWindow&&(this.textMarker.events.register("click",this,this.onClick),this.textMarker.icon.textDiv.style.cursor="pointer")),this.textMarker},onClick:function(a){OpenLayers.Event.stop(a),this.isVibrating()&&this.vibrateOff();if(!this.showWindow)return;this.windowOpened?this.window.select():typeof Weiran=="object"&&Weiran.theOS&&(this.window=Weiran.theOS.getManager().createWindow({title:this.title,width:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_ww")):null,height:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wh")):null,x:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wx")):null,y:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wy")):null,state:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_ws")):"window",iconImageURL:this.iconUrl}),this.windowOpened=!0,this.onWindowOpened(),this.skipMapEvents(),typeof this.windowUrl=="string"&&this.windowUrl!=""?this.windowFramed?this.window.loadUrlX(this.windowUrl,function(a){return function(b){b.onclose=a.onWindowClose(a),b.onmove=a.onWindowMove(a),b.onresize=a.onWindowResize(a)}}(this)):this.window.loadUrl(this.windowUrl,function(a){return function(b){b.onclose=a.onWindowClose(a),b.onmove=a.onWindowMove(a),b.onresize=a.onWindowResize(a)}}(this),function(a){return function(b){b.onclose=a.onWindowClose(a),b.onmove=a.onWindowMove(a),b.onresize=a.onWindowResize(a)}}(this)):(this.window.onclose=this.onWindowClose(this),this.window.onmove=this.onWindowMove(this),this.window.onresize=this.onWindowResize(this)))},onWindowOpened:function(){},onDoubleClick:function(a){OpenLayers.Event.stop(a),this.dragHandler.active?(this.dragHandler.deactivate(),this.enlarge(1),OpenLayers.Element.removeClass(this.marker.icon.imageDiv,"olDragDown")):(this.dragHandler.activate(),this.enlarge(2),OpenLayers.Element.addClass(this.marker.icon.imageDiv,"olDragDown"))},setOpacity:function(a){this.marker&&this.marker.setOpacity(a),this.textMarker&&this.textMarker.setOpacity(a)},moveTo:function(a){if(a==null)return;this.marker&&(this.marker.moveTo(a),this.marker.lonlat=this.lonlat),this.textMarker&&(this.textMarker.moveTo(a),this.textMarker.lonlat=this.lonlat)},updatePosition:function(a){a&&a.clone&&(this.lonlat=a.clone()),this.lonlat.transform(this.layer.projection,this.map.getProjectionObject());var b=this.map.getLayerPxFromLonLat(this.lonlat);b&&this.moveTo(b),b=null},enlarge:function(a){var b=a?Math.abs(a):2,c=this.markerSize.clone();c.w*=b,c.h*=b,this.marker.icon.setSize(c)},vibrateOn:function(a,b){var c=a?Math.abs(a):1,d=b?Math.abs(b):2,e=!1;this.vibrateTimer=setInterval(function(a,b,c){return function(){var d=a.marker.icon.size.clone();c?(a.marker.icon.setSize(a.markerSize.clone()),c=!1):(d.w=d.w*b,d.h=d.h*b,a.marker.icon.setSize(d),c=!0)}}(this,d,e),1e3/c)},vibrateOff:function(){clearInterval(this.vibrateTimer),this.vibrateTimer=null,this.marker.icon.setSize(this.markerSize.clone())},isVibrating:function(){return this.vibrateTimer!=null?!0:!1},updateTitle:function(a){typeof a=="string"&&a.length>0&&this.title!==a&&(this.title=a,this.textMarker.setText(this.title))},onWindowClose:function(a){return function(){a.windowOpened=!1,a.window=null}},onWindowMove:function(a){return function(b,c){if($&&$.cookies&&$.md5){var d={expiresAt:new Date(2099,12,31)};$.cookies.set($.md5(a.title+"_wx"),b+"",d),$.cookies.set($.md5(a.title+"_wy"),c+"",d)}}},onWindowResize:function(a){return function(b,c,d){if($&&$.cookies&&$.md5){var e={expiresAt:new Date(2099,12,31)};switch(d){case"resize":$.cookies.set($.md5(a.title+"_ww"),b+"",e),$.cookies.set($.md5(a.title+"_wh"),c+"",e);break;case"maximize":$.cookies.set($.md5(a.title+"_ws"),"maximized",e);break;case"restore":$.cookies.set($.md5(a.title+"_ws"),"window",e)}}}},skipMapEvents:function(){if(jwim&&this.window instanceof jwim.Window){var a=this.window.getComponent("window");OpenLayers.Event.observe(a,"mousedown",OpenLayers.Function.bindAsEventListener(this._stopEvents,this)),OpenLayers.Event.observe(a,"click",OpenLayers.Function.bindAsEventListener(this._stopEvents,this)),OpenLayers.Event.observe(a,"dblclick",OpenLayers.Function.bindAsEventListener(this._stopEvents,this))}},_stopEvents:function(a){OpenLayers.Event.stop(a,!0)},onDrag:function(a){this.lonlat=this.map.getLonLatFromPixel(a).transform(this.map.getProjectionObject(),this.layer.projection),this.updatePosition()},onDragDone:function(a){},CLASS_NAME:"OpenLayers.WeMarker"}),OpenLayers.WeMarker.defaultIcon=function(a){var a=a?a:OpenLayers.Util.getImagesLocation()+"marker_icon_default.png",b=new OpenLayers.Size(32,32),c=function(a){return new OpenLayers.Pixel(-(a.w/2),-(a.h/2))};return new OpenLayers.Icon(a,b,null,c)},OpenLayers.WeMarker.defaultTextIcon=function(a){var a=a?a:"Weiran Text Marker",b=new OpenLayers.Size(128,16),c=function(a){return new OpenLayers.Pixel(18,-(a.h/2))};return new OpenLayers.WeTextIcon(a,b,null,c)},OpenLayers.WeSensor=OpenLayers.Class(OpenLayers.WeMarker,{rtsvr:null,htsvr:null,socket:null,initialize:function(a){OpenLayers.WeMarker.prototype.initialize.apply(this,arguments),typeof a=="object"&&(this.rtsvr=a.realtimeserver?a.realtimeserver:"",this.htsvr=a.historyserver?a.historyserver:""),typeof this.rtsvr=="string"&&this.rtsvr!==""&&typeof io=="object"&&(this.socket=io.connect(this.rtsvr)),this.socket!=null&&(this.socket.on("connect",this.onConnect(this)),this.socket.on("disconnect",this.onDisconnect(this)),this.socket.on("message",this.onMessage(this)))},destroy:function(){this.socket!=null&&(this.socket.disconnect(),this.socket=null),OpenLayers.WeMarker.prototype.destroy.apply(this,arguments)},onConnect:function(a){return function(){}},onDisconnect:function(a){return function(){}},onMessage:function(a){return function(a){}},CLASS_NAME:"OpenLayers.WeSensor"}),OpenLayers.WeSensor.WeWebcam=OpenLayers.Class(OpenLayers.WeSensor,{initialize:function(a){OpenLayers.WeSensor.prototype.initialize.apply(this,arguments),this.title=a&&a.title?a.title:OpenLayers.i18n("WeWebcam_name"),this.iconUrl=a&&a.iconurl?a.iconurl:OpenLayers.Util.getImagesLocation()+"we_webcam.png",this.showWindow=!0,this.windowFramed=!0},CLASS_NAME:"OpenLayers.WeSensor.WeWebcam"}),OpenLayers.Layer.WeCelestial=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!0,wrapDateLine:!0,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){if(c&&c.sphericalMercator||this.sphericalMercator)c=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-20037508.3392,-20037508.3392,20037508.3392,20037508.3392),maxResolution:156543.0339,numZoomLevels:13,units:"m",projection:"EPSG:900913"},c);b=b||this.url,a=a||this.name;var d=[a,b,{},c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeCelestial(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]),a},getURL:function(a){return""},getXYZ:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);return this.wrapDateLine&&(c=(c%f+f)%f),{x:c,y:d,z:e}},addTile:function(a,b){return new OpenLayers.Tile.Image(this,b,a,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.WeCelestial"}),OpenLayers.Layer.WeMoon=OpenLayers.Class(OpenLayers.Layer.WeCelestial,{attribution:"Image Data - <a href='http://www.google.com/sky'>Google Sky</a>",url:"http://mw1.google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/",initialize:function(a,b,c){OpenLayers.Layer.WeCelestial.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeMoon_name")},getURL:function(a){var b=this.getXYZ(a),c=Math.pow(2,b.z);return this.url+b.z+"/"+b.x+"/"+(c-b.y-1)+".jpg"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeMoon(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeCelestial.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeMoon"}),OpenLayers.Layer.WeMars=OpenLayers.Class(OpenLayers.Layer.WeCelestial,{attribution:"Image Data - <a href='http://www.google.com/sky'>Google Sky</a>",url:"visible",initialize:function(a,b,c){OpenLayers.Layer.WeCelestial.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeMars_name")},getURL:function(a){var b=this.getXYZ(a),c=Math.pow(2,b.z),d=b.x,e=b.y,f=["t"];for(var g=0;g<b.z;g++)c/=2,e<c?d<c?f.push("q"):(f.push("r"),d-=c):d<c?(f.push("t"),e-=c):(f.push("s"),d-=c,e-=c);return"http://mw1.google.com/mw-planetary/mars/"+this.url+"/"+f.join("")+".jpg"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeMoon(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeCelestial.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeMars"}),OpenLayers.Layer.WeSky=OpenLayers.Class(OpenLayers.Layer.WeCelestial,{attribution:"Image Data - <a href='http://www.google.com/sky'>Google Sky</a>",url:"http://mw1.google.com/mw-planetary/sky/skytiles_v1/",initialize:function(a,b,c){OpenLayers.Layer.WeCelestial.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeSky_name")},getURL:function(a){var b=this.getXYZ(a);return this.url+b.x+"_"+b.y+"_"+b.z+".jpg"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeMoon(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeCelestial.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeSky"}),OpenLayers.WeSensor.WeAccount=OpenLayers.Class(OpenLayers.WeSensor,{popupDiv:null,logDiv:null,actDiv:null,btnUpdatePos:null,btnWatchPos:null,msgDiv:null,msgInput:null,msgButton:null,geolocate:null,clients:null,initialize:function(a){OpenLayers.WeSensor.prototype.initialize.apply(this,arguments),this.showWindow=!0,this.log("network status: disconnected"),this.socket!=null&&(this.socket.on("error",this.onError(this)),this.socket.on("access",this.onAccess(this)),this.socket.on("clientspos",this.onClientsPos(this)),this.socket.on("clientnewpos",this.onClientNewPos(this)),this.socket.on("clientonline",this.onClientOnLine(this)),this.socket.on("clientoffline",this.onClientOffLine(this)),this.socket.on("broadcastmsg",this.onBroadcastMsg(this))),this.createDivs(),this.clients={}},destroy:function(){this.geolocate&&(this.map.removeControl(this.geolocate),this.geolocate.destroy(),this.geolocate=null),this.clearClients(),this.destroyDivs(),OpenLayers.WeSensor.prototype.destroy.apply(this,arguments)},createDivs:function(){this.popupDiv==null&&(this.popupDiv=document.createElement("div")),this.popupDiv.className="olWeAccount",this.msgDiv=document.createElement("div"),this.msgDiv.className="olWeAccountMessage",this.msgInput=document.createElement("input"),this.msgInput.setAttribute("type","text"),this.msgInput.setAttribute("maxlength","60"),this.msgButton=document.createElement("input"),this.msgButton.setAttribute("type","button"),this.msgButton.setAttribute("value",OpenLayers.i18n("WeAccount_broadcast")),this.msgDiv.appendChild(this.msgInput),this.msgDiv.appendChild(this.msgButton),this.popupDiv.appendChild(this.msgDiv),typeof jQuery=="function"&&$(this.msgButton).click(this.onBroadcast(this)),this.actDiv=document.createElement("div"),this.actDiv.className="olWeAccountAct",this.btnUpdatePos=document.createElement("a"),this.btnUpdatePos.setAttribute("href","#"),this.btnUpdatePos.innerHTML=OpenLayers.i18n("WeAccount_updatePos"),this.btnWatchPos=document.createElement("a"),this.btnWatchPos.setAttribute("href","#"),this.btnWatchPos.innerHTML=OpenLayers.i18n("WeAccount_watchPos"),this.actDiv.appendChild(this.btnUpdatePos),this.actDiv.appendChild(this.btnWatchPos),this.popupDiv.appendChild(this.actDiv),typeof jQuery=="function"&&($(this.btnUpdatePos).click(this.onUpdatePos(this)),$(this.btnWatchPos).click(this.onWatchPos(this))),this.logDiv=document.createElement("div"),this.logDiv.className="olWeAccountLog",this.popupDiv.appendChild(this.logDiv)},destroyDivs:function(){this.logDiv=null,this.actDiv=null,this.btnUpdatePos=null,this.btnWatchPos=null,this.popupDiv=null},onWindowOpened:function(){OpenLayers.WeSensor.prototype.onWindowOpened.apply(this,arguments),this.window.getComponent("content").innerHTML="",this.window.getComponent("content").appendChild(this.popupDiv)},clearClients:function(){if(this.clients){for(var a in this.clients)this.clients[a]instanceof OpenLayers.WeSensor.WeFriend&&this.layer.removeSensor(this.clients[a]);this.clients=null}},log:function(a){this.logDiv!=null&&typeof a=="string"&&(this.logDiv.innerHTML=a+"<br />"+this.logDiv.innerHTML)},onFirstDraw:function(a){OpenLayers.WeSensor.prototype.onFirstDraw.apply(this,arguments),typeof require=="function"&&require({waitSeconds:60},["http://j.maxmind.com/app/geoip.js"],function(a){return function(){a.updatePosition(new OpenLayers.LonLat(parseFloat(geoip_longitude())+.01*Math.random()-.005,parseFloat(geoip_latitude())+.01*Math.random()-.005)),a.map.setCenter(a.lonlat),a.updateClientPos(),a.log("geoposition updated")}}(this)),this.geolocate=new OpenLayers.Control.Geolocate({bind:!0,watch:!1}),this.map.addControl(this.geolocate),this.geolocate.events.register("locationupdated",this,this.onLocationUpdated),this.geolocate.events.register("locationfailed",this,this.onLocationFailed),this.geolocate.events.register("locationuncapable",this,this.onLocationUncapable)},onBroadcast:function(a){return function(){var b=$.trim($(a.msgInput).val());b&&b.length>0?(a.socket.emit("broadcastmsg",b),a.log("message has been broadcasted")):a.log("there is no message to send")}},onUpdatePos:function(a){return function(){a.geolocate.deactivate(),a.geolocate.watch=!1,a.geolocate.activate()}},onWatchPos:function(a){return function(){a.geolocate.deactivate(),a.geolocate.watch=!0,a.geolocate.activate()}},onLocationUpdated:function(a){this.lonlat.lon=a.position.coords.longitude,this.lonlat.lat=a.position.coords.latitude,this.updatePosition(),this.updateClientPos(),this.log("geoposition updated")},onLocationFailed:function(a){this.log("failed to update geoposition")},onLocationUncapable:function(a){this.log("geoposition uncapable on your browser")},onDrag:function(a){OpenLayers.WeSensor.prototype.onDrag.apply(this,arguments),this.log(this.lonlat.toShortString())},onDragDone:function(a){OpenLayers.WeSensor.prototype.onDragDone.apply(this,arguments),this.socket?(this.socket.socket.connected&&(this.updateClientPos(),this.log("network status: connected")),this.socket.socket.connecting&&this.log("network status: connecting"),this.socket.socket.reconnecting&&this.log("network status: reconnecting")):this.log("network status: disconnected")},onError:function(a){return function(b){a.log("error: "+b)}},onAccess:function(a){return function(b){a.log("accessed")}},onClientsPos:function(a){return function(b){a.log("received all clients positions");if(typeof b=="object")for(var c in b){var d=new OpenLayers.WeSensor.WeFriend({lon:b[c].longitude?b[c].longitude:0,lat:b[c].latitude?b[c].latitude:0});d.socketId=c,a.layer.addMarker(d),a.clients[c]=d}}},onClientNewPos:function(a){return function(b,c){a.log("update client "+b+" position"),a.clients[b]&&a.clients[b]instanceof OpenLayers.WeSensor.WeFriend&&a.clients[b].updatePosition(new OpenLayers.LonLat(c.longitude?c.longitude:0,c.latitude?c.latitude:0))}},onClientOnLine:function(a){return function(b){a.log("client "+b+" online");if(!a.clients[b]&&typeof b=="string"&&b.length>0){var c=new OpenLayers.WeSensor.WeFriend;c.socketId=b,a.layer.addSensor(c),a.clients[b]=c}}},onClientOffLine:function(a){return function(b){a.log("client "+b+" offline"),a.clients&&a.clients[b]instanceof OpenLayers.WeSensor.WeFriend&&(a.layer.removeSensor(a.clients[b]),a.clients[b]=null)}},onBroadcastMsg:function(a){return function(b,c){a.log("client "+b+" broadcast message"),a.clients&&a.clients[b]instanceof OpenLayers.WeSensor.WeFriend&&a.clients[b].updateMessage(c)}},signIn:function(a,b){return this.socket?typeof a!="string"||typeof b!="string"?!1:(this.socket.emit("signin",a,b),!0):!1},logOut:function(a){return this.socket?typeof a!="string"?!1:(this.socket.emit("signout",a),!0):!1},createAccount:function(a,b){return!this.socket||!this.socket.socket.connected?!1:typeof a!="string"||typeof b!="string"?!1:(this.socket.emit("create",a,b),!0)},updateClientPos:function(){if(!this.socket||!this.socket.socket.connected)return!1;if(!this.lonlat)return!1;var a={},b=this.lonlat.clone();return b.transform(this.map.getProjectionObject(),this.layer.projection),a.longitude=b.lon.toFixed(6),a.latitude=b.lat.toFixed(6),typeof geoip_latitude=="function"&&(a.city=geoip_city(),a.region=geoip_region(),a.regionName=geoip_region_name(),a.countryCode=geoip_country_code(),a.countryName=geoip_country_name()),this.socket.emit("updatepos",a),!0},CLASS_NAME:"OpenLayers.WeSensor.WeAccount"}),OpenLayers.Lang["zh-CN"]={unhandledRequest:"未处理的请求，返回值为 ${statusText}",Permalink:"永久链接",Overlays:"叠加层","Base Layer":"基础图层",readNotImplemented:"读取功能没有实现。",writeNotImplemented:"写入功能没有实现。",noFID:"无法更新feature，缺少FID。",errorLoadingGML:"加载GML文件 ${url} 出现错误。",browserNotSupported:"你使用的浏览器不支持矢量渲染。当前支持的渲染方式包括：\n${renderers}",componentShouldBe:"addFeatures : 组件类型应该是 ${geomType}",getFeatureError:"getFeatureFromEvent方法在一个没有渲染器的图层上被调用。 这通常意味着您销毁了一个图层，但并未销毁其关联的handler。",minZoomLevelError:"minZoomLevel属性仅适合用于使用了固定缩放级别的图层。这个 wfs 图层检查 minZoomLevel 是过去遗留下来的。然而，我们不能移除它，而破坏依赖于它的基于OL的应用程序。因此，我们废除了它 -- minZoomLevel 将会在3.0中被移除。请改用 min/max resolution 设置，参考：http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: 成功。 ${response}",commitFailed:"WFS Transaction: 失败。 ${response}",googleWarning:"Google图层不能正确加载。<br><br>要消除这个信息，请在右上角的图层控制面板中选择其他的基础图层。<br><br>这种情况很可能是没有正确的包含Google地图脚本库，或者是没有包含在你的站点上使用的正确的Google Maps API密匙。<br><br>开发者：获取使其正确工作的帮助信息，<a href='http://trac.openlayers.org/wiki/Google' target='_blank'>点击这里</a>",getLayerWarning:"${layerType} 图层不能正确加载。<br><br>要消除这个信息，请在右上角的图层控制面板中选择其他的基础图层。<br><br>这种情况很可能是没有正确的包含${layerLib} 脚本库。<br><br>开发者：获取使其正确工作的帮助信息，<a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>点击这里</a>","Scale = 1 : ${scaleDenom}":"比例尺 = 1 : ${scaleDenom}",W:"西",E:"东",N:"北",S:"南",Graticule:"坐标网格",layerAlreadyAdded:"你尝试添加图层： ${layerName} 到地图中，但是它之前就已经被添加。",reprojectDeprecated:"你正在使用 ${layerName} 图层上的'reproject'选项。这个选项已经不再使用：它是被设计用来支持显示商业的地图数据，不过现在该功能可以通过使用Spherical Mercator来实现。更多信息可以参阅http://trac.openlayers.org/wiki/SphericalMercator。",methodDeprecated:"该方法已经不再被支持，并且将在3.0中被移除。请使用 ${newMethod} 方法来替代。",boundsAddError:"您必须传递 x 和 y 两个参数值到 add 方法。",lonlatAddError:"您必须传递 lon 和 lat 两个参数值到 add 方法。",pixelAddError:"您必须传递 x and y 两个参数值到 add 方法。",unsupportedGeometryType:"不支持的几何体类型： ${geomType}",filterEvaluateNotImplemented:"不支持的滤镜类型",proxyNeeded:"您必须设置OpenLayers.ProxyHost才能访问${url}。请参考http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost。",WeTextIcon:"文字地标",WeAccount_name:"匿名用户",WeAccount_updatePos:"更新位置",WeAccount_watchPos:"跟踪位置",WeAccount_broadcast:"广播",WeFriend_name:"匿名好友",WeGT02A_Address:"详细地址",WeGT02A_Track:"跟踪",WeGT02A_History:"历史数据",WeWebcam_name:"摄像头",OSM_name:"开源地图",WeBaidu_name:"百度地图",WeMoon_name:"谷歌月球地图",WeMars_name:"谷歌火星地图",WeSky_name:"谷歌星空图",WeGoogleMap_name:"谷歌地图",WeGoogleSatellite_name:"谷歌卫星地图",WeGoogleToponym_name:"谷歌地名数据",WeGoogleTerrian_name:"谷歌地形图",WeMapABC_name:"MapABC地图",WeSensors_name:"传感器",WeMarkers_name:"地标层",WeAccounts_name:"用户层",WeWXRain_name:"6小时降水预报",WeWXWind_name:"6小时风预报",WeWXTemperature_name:"6小时气温预报",WeWXWaveHeight_name:"6小时浪高预报",WeWXCloudIR_name:"红外波段卫星云图",WeWXCloudVisible_name:"可见波段卫星云图",WeMainPanel_title:"系统面板",WeOverviewMap_title:"鹰眼地图",end:"结束"},OpenLayers.Layer.WeMapABC=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Image Data - <a href='http://mapabc.com/'>MapABC</a>",sphericalMercator:!0,wrapDateLine:!0,url:["http://emap0.is.autonavi.com/appmaptile?z=${z}&x=${x}&y=${y}","http://emap1.is.autonavi.com/appmaptile?z=${z}&x=${x}&y=${y}","http://emap2.is.autonavi.com/appmaptile?z=${z}&x=${x}&y=${y}","http://emap3.is.autonavi.com/appmaptile?z=${z}&x=${x}&y=${y}"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeMapABC_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeMapABC(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeMapABC"}),OpenLayers.Layer.WeMapABCTraffic=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Traffic Data - <a href='http://mapabc.com/'>MapABC</a>",sphericalMercator:!0,wrapDateLine:!0,isBaseLayer:!1,visibility:!1,url:["http://tm.mapabc.com/trafficengine/mapabc/traffictile?v=1.0&t=1&zoom=${z}&x=${x}&y=${y}"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeMapABCTraffic_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f),e=17-e;var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeMapABCTraffic(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeMapABCTraffic"}),OpenLayers.Layer.WeGoogleMap=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Image Data - <a href='http://maps.google.com/'>Google Inc.</a>",sphericalMercator:!0,wrapDateLine:!0,url:["http://mt0.google.com/vt/lyrs=m@169000000&x=${x}&y=${y}&z=${z}&s=Galileo","http://mt1.google.com/vt/lyrs=m@169000000&x=${x}&y=${y}&z=${z}&s=Galileo"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeGoogleMap_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeGoogleMap(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeGoogleMap"}),OpenLayers.Layer.WeGoogleSatellite=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Image Data - <a href='http://maps.google.com/'>Google Inc.</a>",sphericalMercator:!0,wrapDateLine:!0,url:["http://khm0.google.com/kh/v=101&x=${x}&y=${y}&z=${z}&s=Galileo","http://khm1.google.com/kh/v=101&x=${x}&y=${y}&z=${z}&s=Galileo"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeGoogleSatellite_name"),this.events.register("visibilitychanged",this,this.onVisibilityChanged)},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeGoogleSatellite(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},onVisibilityChanged:function(a){var b=this.map.getLayersByClass("OpenLayers.Layer.WeGoogleToponym");for(var c=0;c<b.length;c++)b[c].setVisibility(this.getVisibility())},CLASS_NAME:"OpenLayers.Layer.WeGoogleSatellite"}),OpenLayers.Layer.WeGoogleToponym=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Image Data - <a href='http://maps.google.com/'>Google Inc.</a>",sphericalMercator:!0,wrapDateLine:!0,isBaseLayer:!1,visibility:!1,url:["http://mt0.google.com/vt/lyrs=h@169000000&x=${x}&y=${y}&z=${z}&s=Galileo","http://mt1.google.com/vt/lyrs=h@169000000&x=${x}&y=${y}&z=${z}&s=Galileo"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeGoogleToponym_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeGoogleToponym(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeGoogleToponym"}),OpenLayers.Layer.WeGoogleTerrian=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"Image Data - <a href='http://maps.google.com/'>Google Inc.</a>",sphericalMercator:!0,wrapDateLine:!0,url:["http://mt0.google.com/vt/lyrs=t@128,r@169000000&x=${x}&y=${y}&z=${z}&s=Galileo","http://mt1.google.com/vt/lyrs=t@128,r@169000000&x=${x}&y=${y}&z=${z}&s=Galileo"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeGoogleTerrian_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom()+this.zoomOffset,f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeGoogleTerrian(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeGoogleTerrian"}),OpenLayers.Control.WeOverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan
:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.title=OpenLayers.i18n("WeOverviewMap_title")},destroy:function(){if(!this.mapDiv)return;this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(OpenLayers.Event.stopObservingElement(this.maximizeDiv),this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(OpenLayers.Event.stopObservingElement(this.minimizeDiv),this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container",this.maximizeDiv=document.createElement("div"),this.maximizeDiv.id="OpenLayers_Control_MaximizeDiv",this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),this.div.appendChild(this.maximizeDiv),this.minimizeDiv=document.createElement("div"),this.minimizeDiv.id="OpenLayers_Control_MinimizeDiv",this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),this.div.appendChild(this.minimizeDiv);var b=["dblclick","mousedown"];for(var c=0,d=b.length;c<d;c++)OpenLayers.Event.observe(this.maximizeDiv,b[c],OpenLayers.Event.stop),OpenLayers.Event.observe(this.minimizeDiv,b[c],OpenLayers.Event.stop);this.minimizeControl()}else this.element.style.display="";return this.map.getExtent()&&this.update(),this.map.events.register("moveend",this,this.update),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(b!=0||c!=0){var d=this.rectPxBounds.top,e=this.rectPxBounds.left,f=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),h=Math.max(0,d-c);h=Math.min(h,this.ovmap.size.h-this.hComp-f);var i=Math.max(0,e-b);i=Math.min(i,this.ovmap.size.w-this.wComp-g),this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,g=Math.abs(this.rectPxBounds.getHeight()),h=this.rectPxBounds.getWidth(),i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g);var j=Math.max(0,f+c);j=Math.min(j,this.ovmap.size.w-h),this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i)),this.updateMapToRect()},maximizeControl:function(a){typeof jQuery=="function"?jQuery(this.element).show("fast"):this.element.style.display="",this.showToggle(!1),a!=null&&OpenLayers.Event.stop(a)},minimizeControl:function(a){typeof jQuery=="function"?jQuery(this.element).fadeOut("slow"):this.element.style.display="none",this.showToggle(!0),a!=null&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":""},update:function(){this.ovmap==null&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.maxExtent,c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);var d;this.ovmap.getProjection()!=this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center,this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(b*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);a.theme=null,this.ovmap=new OpenLayers.Map(this.mapDiv,a),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(a){!this.handlers.drag.active&&!this.map.dragging&&this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(a){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=b&&c?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var a;this.ovmap.getProjection()!=this.map.getProjection()?a=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):a=this.map.getExtent();var b=this.getRectBoundsFromMapBounds(a);b&&this.setRectPxBounds(b)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),f=Math.max(e-c,0),g=Math.max(d-b,0);if(f<this.minRectSize||g<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var h=c+f/2-this.minRectSize/2,i=b+g/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(i)+"px",this.extentRectangle.style.left=Math.round(h)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(g)+"px",this.extentRectangle.style.width=Math.round(f)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=new OpenLayers.LonLat(a.left,a.bottom),c=new OpenLayers.LonLat(a.right,a.top),d=this.getOverviewPxFromLonLat(b),e=this.getOverviewPxFromLonLat(c),f=null;return d&&e&&(f=new OpenLayers.Bounds(d.x,d.y,e.x,e.y)),f},getMapBoundsFromRectBounds:function(a){var b=new OpenLayers.Pixel(a.left,a.bottom),c=new OpenLayers.Pixel(a.right,a.top),d=this.getLonLatFromOverviewPx(b),e=this.getLonLatFromOverviewPx(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat(),e=a.x-b.w/2,f=a.y-b.h/2;return new OpenLayers.LonLat(d.lon+e*c,d.lat-f*c)},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent(),d=null;return c&&(d=new OpenLayers.Pixel(Math.round(1/b*(a.lon-c.left)),Math.round(1/b*(c.top-a.lat)))),d},CLASS_NAME:"OpenLayers.Control.WeOverviewMap"}),OpenLayers.WeSensor.WeMMS=OpenLayers.Class(OpenLayers.WeSensor,{contentHTML:null,initialize:function(a){OpenLayers.WeSensor.prototype.initialize.apply(this,arguments),this.title=a&&a.title?a.title:OpenLayers.i18n("WeWebcam_name"),this.iconUrl=a&&a.iconurl?a.iconurl:OpenLayers.Util.getImagesLocation()+"we_webcam.png",this.showWindow=!0,this.windowFramed=!1,this.contentHTML="<embed src='"+this.windowUrl+"'"+"width='100%' height='100%' "+" autostart='1' showcontrols='0' type='application/x-mplayer2' "+" pluginspage='http://www.microsoft.com/windows/windowsmedia/download/' >Your Browser Not Support</embed>"},destroy:function(){this.contentHTML=null,OpenLayers.WeSensor.prototype.destroy.apply(this,arguments)},onWindowOpened:function(){OpenLayers.WeSensor.prototype.onWindowOpened.apply(this,arguments),this.window.setContent(this.contentHTML)},CLASS_NAME:"OpenLayers.WeSensor.WeMMS"}),OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:!1,visible:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},setVisible:function(a){this.visible=a,a?OpenLayers.Element.show(this.div):OpenLayers.Element.hide(this.div)},getVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},toggle:function(){this.setVisible(!this.getVisible())},addLayer:function(a){a.layer&&(a.layer.events.register("loadstart",this,this.increaseCounter),a.layer.events.register("loadend",this,this.decreaseCounter))},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("preaddlayer",this,this.addLayer);for(var b=0;b<this.map.layers.length;b++){var c=this.map.layers[b];c.events.register("loadstart",this,this.increaseCounter),c.events.register("loadend",this,this.decreaseCounter)}},increaseCounter:function(){this.counter++,this.counter>0&&!this.maximized&&this.visible&&this.maximizeControl()},decreaseCounter:function(){this.counter>0&&this.counter--,this.counter==0&&this.maximized&&this.visible&&this.minimizeControl()},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.div},minimizeControl:function(a){this.div.style.display="none",this.maximized=!1,a!=null&&OpenLayers.Event.stop(a)},maximizeControl:function(a){this.div.style.display="block",this.maximized=!0,a!=null&&OpenLayers.Event.stop(a)},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);if(this.map.layers)for(var a=0;a<this.map.layers.length;a++){var b=this.map.layers[a];b.events.unregister("loadstart",this,this.increaseCounter),b.events.unregister("loadend",this,this.decreaseCounter)}}OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.LoadingPanel"}),OpenLayers.Layer.WeMarkers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(a,b){b=OpenLayers.Util.extend({projection:"EPSG:4326"},b),OpenLayers.Layer.prototype.initialize.apply(this,[a,b]),this.name||(this.name=OpenLayers.i18n("WeMarkers_name")),this.markers=[],this.events.register("visibilitychanged",this,this.onVisibilityChanged)},destroy:function(){this.clearMarkers(),this.markers=null,this.events.unregister("visibilitychanged",this,this.onVisibilityChanged),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},onVisibilityChanged:function(){var a;for(a=0;a<this.markers.length;a++)this.markers[a].window&&this.markers[a].windowOpened&&(this.markers[a].window.close(),this.markers[a].window=null,this.markers[a].windowOpened=!1)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.markers.length;b<c;b++)this.markers[b].setOpacity(this.opacity)}},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var d=0,e=this.markers.length;d<e;d++)this.drawMarker(this.markers[d]);this.drawn=!0}},addMarker:function(a){a.layer||(a.layer=this),this.markers.push(a),this.opacity!=null&&a.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.destroy())},clearMarkers:function(){if(this.markers!=null)while(this.markers.length>0)this.removeMarker(this.markers[0])},drawMarker:function(a){a.bFirstDraw&&(a.onFirstDraw(),a.bFirstDraw=!1);var b=this.map.getLayerPxFromLonLat(a.lonlat);a.marker||(a.createMarker(),a.marker.map=this.map,a.marker.draw(b),this.div.appendChild(a.marker.icon.imageDiv)),a.textMarker||(a.createTextMarker(),a.textMarker.map=this.map,this.div.appendChild(a.textMarker.icon.textDiv)),b==null?(a.marker.display(!1),a.textMarker.display(!1)):a.moveTo(b)},getDataExtent:function(){var a=null;if(this.markers&&this.markers.length>0){var a=new OpenLayers.Bounds;for(var b=0,c=this.markers.length;b<c;b++){var d=this.markers[b];a.extend(d.lonlat)}}return a},CLASS_NAME:"OpenLayers.Layer.WeMarkers"}),OpenLayers.Layer.WeAccounts=OpenLayers.Class(OpenLayers.Layer.WeMarkers,{initialize:function(){OpenLayers.Layer.WeMarkers.prototype.initialize.apply(this,arguments),this.name=OpenLayers.i18n("WeAccounts_name"),this.events.register("added",this,this.onAdded)},destroy:function(){this.events.unregister("added",this,this.onAdded),OpenLayers.Layer.WeMarkers.prototype.destroy.apply(this,arguments)},onAdded:function(a){},CLASS_NAME:"OpenLayers.Layer.WeAccounts"}),OpenLayers.WeSensor.WeFriend=OpenLayers.Class(OpenLayers.WeSensor,{logDiv:null,socketId:null,initialize:function(a){OpenLayers.WeSensor.prototype.initialize.apply(this,arguments),this.title=a&&a.title?a.title:OpenLayers.i18n("WeFriend_name"),this.iconUrl=a&&a.iconurl?a.iconurl:OpenLayers.Util.getImagesLocation()+"we_friend.png",this.logDiv=document.createElement("div"),this.logDiv.className="olWeFriendLog"},destroy:function(){this.logDiv.innerHTML="",this.logDiv=null,this.socketId=null,OpenLayers.WeSensor.prototype.destroy.apply(this,arguments)},onWindowOpened:function(){OpenLayers.WeSensor.prototype.onWindowOpened.apply(this,arguments),this.window.getComponent("content").innerHTML="",this.window.getComponent("content").appendChild(this.logDiv)},log:function(a){this.logDiv!=null&&typeof a=="string"&&(this.logDiv.innerHTML=a+"<br />"+this.logDiv.innerHTML)},updateMessage:function(a){typeof a=="string"&&(this.log(a),this.windowOpened||this.vibrateOn())},CLASS_NAME:"OpenLayers.WeSensor.WeFriend"}),OpenLayers.Popup.WePopup=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{positionBlocks:{tl:{offset:new OpenLayers.Pixel(42,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-42,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(42,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-42,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},pinDiv:null,loadingDiv:null,frame:null,url:null,initialize:function(a,b,c,d,e){OpenLayers.Popup.FramedCloud.prototype.initialize.apply(this,[a,b,c,d,e,!0]),this.contentDiv.className="olWePopupContent",this.panMapIfOutOfView=!1,this.autoSize=!1,this.addPinBox(),this.pinDiv.style.zIndex=1,this.addLoadingBox(),this.loadingDiv.style.zIndex=1,this.hideLoading(),this.events.addEventType("opened"),this.events.addEventType("closed")},destroy:function(){this.pinDiv&&(OpenLayers.Event.stopObservingElement(this.pinDiv),this.groupDiv.removeChild(this.pinDiv)),this.pinDiv=null,this.loadingDiv&&this.groupDiv.removeChild(this.loadingDiv),this.loadingDiv=null,this.frame&&(OpenLayers.Event.stopObserving(this.frame,"load",this.onFrameLoad(this)),this.frame=null),OpenLayers.Popup.FramedCloud.prototype.destroy.apply(this,arguments)},show:function(){OpenLayers.Popup.FramedCloud.prototype.show.apply(this,arguments),this.events.triggerEvent("opened")},hide:function(){OpenLayers.Popup.FramedCloud.prototype.hide.apply(this,arguments),this.events.triggerEvent("closed")},setContentNode:function(a){a!=null&&a.innerHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML="",this.contentDiv.appendChild(a),this.contentHTML=this.contentDiv.innerHTML,this.autoSize&&this.updateSize())},addPinBox:function(){this.pinDiv=OpenLayers.Util.createDiv(this.id+"_pin",null,new OpenLayers.Size(17,17)),this.panMapIfOutOfView?this.pinDiv.className="olWePopupPinBoxDown":this.pinDiv.className="olWePopupPinBoxUp",this.groupDiv.appendChild(this.pinDiv);var a=function(a){this.panMapIfOutOfView?(this.panMapIfOutOfView=!1,this.pinDiv.className="olWePopupPinBoxUp"):(this.panMapIfOutOfView=!0,this.pinDiv.className="olWePopupPinBoxDown"),OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.pinDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},addLoadingBox:function(){this.loadingDiv=OpenLayers.Util.createDiv(this.id+"_loading",null,new OpenLayers.Size(16,16)),this.loadingDiv.className="olWePopupLoading",this.groupDiv.appendChild(this.loadingDiv)},updateRelativePosition:function(){OpenLayers.Popup.FramedCloud.prototype.updateRelativePosition.apply(this,arguments);var a=this.getContentDivPadding();this.pinDiv&&(this.pinDiv.style.right=a.right+this.padding.right-4+"px",this.pinDiv.style.top=a.top+this.padding.top+18+"px",this.closeDiv&&(this.closeDiv.style.right=this.pinDiv.style.right)),this.loadingDiv&&(this.loadingDiv.style.right=a.right+this.padding.right-3+"px",this.loadingDiv.style.top=a.top+this.padding.top+38+"px")},showLoading:function(){this.loadingDiv.style.display=""},hideLoading:function(){this.loadingDiv.style.display="none"},loadUrl:function(a){if(!a||typeof a!="string"||a===this.url)return;this.url=a,this.showLoading();if(this.frame){this.frame.src=this.url;return}this.frame=document.createElement("iframe"),this.frame.className="olWePopupFrame",this.frame.src=this.url,this.contentDiv.innerHTML="",this.contentDiv.appendChild(this.frame),OpenLayers.Event.observe(this.frame,"load",this.onFrameLoad(this))},unloadUrl:function(){this.url="",this.frame&&(this.frame.src=this.url)},onFrameLoad:function(a){return function(){a.hideLoading()}},CLASS_NAME:"OpenLayers.Popup.WePopup"}),OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layers",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access ${url}.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",WeTextIcon:"WeTextIcon",WeAccount_name:"Anonymous",WeAccount_updatePos:"Update Position",WeAccount_watchPos:"Watch Position",WeAccount_broadcast:"Broadcast",WeFriend_name:"Anonymous Friend",WeGT02A_Address:"Address",WeGT02A_Track:"Track",WeGT02A_History:"History Data",WeWebcam_name:"Unkown Webcam",OSM_name:"Open Street Map",WeBaidu_name:"Baidu Maps",WeMoon_name:"Google Moon",WeMars_name:"Google Mars",WeSky_name:"Google Sky",WeGoogleMap_name:"Google Street",WeGoogleSatellite_name:"Google Satellite",WeGoogleToponym_name:"Google Toponym",WeGoogleTerrian_name:"Google Terrian",WeMapABC_name:"MapABC",WeSensors_name:"Sensors",WeMarkers_name:"Place Markers",WeAccounts_name:"Accounts",WeWXRain_name:"6h Rain Forecast",WeWXWind_name:"6h Wind Forecast",WeWXTemperature_name:"6h Temperature Forecast",WeWXWaveHeight_name:"6h Wave Height Forecast",WeWXCloudIR_name:"Infrared Cloud",WeWXCloudVisible_name:"Visible Cloud",WeMainPanel_title:"Main Panel",WeOverviewMap_title:"Overview Map",end:"end"},OpenLayers.Control.WeLayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,ascending:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[],this.roundedCorner=!1},destroy:function(){OpenLayers.Event.stopObservingElement(this.div),this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.redraw(),this.div},clearLayersArray:function(a){var b=this[a+"Layers"];if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c];OpenLayers.Event.stopObservingElement(e.inputElem),OpenLayers.Event.stopObservingElement(e.labelSpan)}this[a+"LayersDiv"].innerHTML="",this[a+"Layers"]=[]},checkRedraw:function(){var a=!1;if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)a=!0;else for(var b=0,c=this.layerStates.length;b<c;b++){var d=this.layerStates[b],e=this.map.layers[b];if(d.name!=e.name||d.inRange!=e.inRange||d.id!=e.id||d.visibility!=e.visibility){a=!0;break}}return a},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=new Array(c);for(var d=0;d<c;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();this.ascending||f.reverse();for(var d=0,c=f.length;d<c;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),i=document.createElement("input");i.id=this.id+"_input_"+e.name,i.name=g?this.id+"_baseLayers":e.name,i.type=g?"radio":"checkbox",i.value=e.name,i.checked=h,i.defaultChecked=h,!g&&!e.inRange&&(i.disabled=!0);var j={inputElem:i,layer:e,layerSwitcher:this};OpenLayers.Event.observe(i,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,j));var k=document.createElement("span");OpenLayers.Element.addClass(k,"labelSpan"),!g&&!e.inRange&&(k.style.color="gray"),k.innerHTML=e.name,k.style.verticalAlign=g?"bottom":"baseline",OpenLayers.Event.observe(k,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,j));var l=document.createElement("br"),m=g?this.baseLayers:this.dataLayers;m.push({layer:e,inputElem:i,labelSpan:k});var n=g?this.baseLayersDiv:this.dataLayersDiv;n.appendChild(i),n.appendChild(k),n.appendChild(l)}}return this.dataLbl.style.display=a?"":"none",this.baseLbl.style.display=b?"":"none",this.div},onInputClick:function(a){this.inputElem.disabled||(this.inputElem.type=="radio"?(this.inputElem.checked=!0,this.layer.map.setBaseLayer(this.layer)):(this.inputElem.checked=!this.inputElem.checked,this.layerSwitcher.updateMap())),OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var a=0,b=this.baseLayers.length;a<b;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}for(var a=0,b=this.dataLayers.length;a<b;a++){var c=this.dataLayers[a];c.layer.setVisibility(c.inputElem.checked)}},loadContents:function(){OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this)),OpenLayers.Event.observe(this.div,"click",this.ignoreEvent),OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this)),OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent),this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75))},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=!0,this.ignoreEvent(a)},mouseUp:function(a){this.isMouseDown&&(this.isMouseDown=!1,this.ignoreEvent(a))},CLASS_NAME:"OpenLayers.Control.WeLayerSwitcher"}),OpenLayers.WeSensor.WeGT02A=OpenLayers.Class(OpenLayers.WeSensor,{imei:null,sensor:null,rtsvr:null,htsvr:null,socket:null,titleDiv:null,powerSpan:null,gsmSpan:null,gnssSpan:null,velocityDiv:null,velocityImg:null,courseDiv:null,courseImg:null,timeDiv:null,addressDiv:null,trackDiv:null,historyDiv:null,initialize:function(a){OpenLayers.WeSensor.prototype.initialize.apply(this,arguments),this.imei=a.imei,this.rtsvr=a.rtsvr,this.htsvr=a.htsvr,this.sensor={},this.popupSize=new OpenLayers.Size(246,142),this.createDivs(),this.rtsvr&&(this.socket=io.connect(this.rtsvr,{"force new connection"
:!0})),this.socket&&(this.socket.wegt02a=this,this.socket.on("connect",this.onConnectHost),this.socket.on("disconnect",this.onDisconnectHost),this.socket.on("message",this.onMessage),this.socket.on("updatepvt",this.onUpdatePVT),this.socket.on("updatepgg",this.onUpdatePGG))},destroy:function(){this.socket&&(this.socket.disconnect(),this.socket.wegt02a=null,this.socket=null),this.destroyDivs(),this.sensor=null,OpenLayers.WeSensor.prototype.destroy.apply(this,arguments)},createDivs:function(){this.popupDiv==null&&(this.popupDiv=document.createElement("div"),this.popupDiv.id=this.imei),this.popupDiv.className="olWeGT02A",this.titleDiv=document.createElement("div"),this.titleDiv.id=this.imei+"_title",this.titleDiv.className="olWeGT02ATitle",this.titleDiv.style.color="#ccc",this.titleDiv.innerHTML=this.title,this.popupDiv.appendChild(this.titleDiv),this.powerSpan=document.createElement("span"),this.powerSpan.id=this.imei+"_power",this.powerSpan.className="olWeGT02APower",this.popupDiv.appendChild(this.powerSpan),this.gsmSpan=document.createElement("span"),this.gsmSpan.id=this.imei+"_gsm",this.gsmSpan.className="olWeGT02AGSM",this.popupDiv.appendChild(this.gsmSpan),this.gnssSpan=document.createElement("span"),this.gnssSpan.id=this.imei+"_gnss",this.gnssSpan.className="olWeGT02AGNSS",this.popupDiv.appendChild(this.gnssSpan),this.velocityDiv=document.createElement("div"),this.velocityDiv.id=this.imei+"_velocity",this.velocityDiv.className="olWeGT02AVelocity",this.velocityImg=document.createElement("img"),this.velocityImg.id=this.velocityDiv.id+"_image",this.velocityImg.src=OpenLayers.Util.getImagesLocation()+"wegt02a_velocity.png",this.velocityDiv.appendChild(this.velocityImg),this.popupDiv.appendChild(this.velocityDiv),this.courseDiv=document.createElement("div"),this.courseDiv.id=this.imei+"_course",this.courseDiv.className="olWeGT02ACourse",this.courseImg=document.createElement("img"),this.courseImg.id=this.courseDiv.id+"_image",this.courseImg.src=OpenLayers.Util.getImagesLocation()+"wegt02a_course.png",this.courseDiv.appendChild(this.courseImg),this.popupDiv.appendChild(this.courseDiv),this.timeDiv=document.createElement("div"),this.timeDiv.id=this.imei+"_time",this.timeDiv.className="olWeGT02ATime",this.timeDiv.innerHTML="0000-00-00<br/>00:00:00",this.popupDiv.appendChild(this.timeDiv),this.addressDiv=document.createElement("div"),this.addressDiv.id=this.imei+"_address",this.addressDiv.className="olWeGT02AAddress",this.addressDiv.innerHTML="<br/>"+OpenLayers.i18n("WeGT02A_Address"),this.popupDiv.appendChild(this.addressDiv),this.trackDiv=document.createElement("div"),this.trackDiv.id=this.imei+"_track",this.trackDiv.className="olWeGT02ATrack",this.trackDiv.innerHTML="<br/>"+OpenLayers.i18n("WeGT02A_Track"),this.popupDiv.appendChild(this.trackDiv),this.historyDiv=document.createElement("div"),this.historyDiv.id=this.imei+"_history",this.historyDiv.className="olWeGT02AHistory",this.historyDiv.innerHTML="<br/>"+OpenLayers.i18n("WeGT02A_History"),this.popupDiv.appendChild(this.historyDiv),this.bindPanelDivEvents()},destroyDivs:function(){this.titleDiv=null,this.powerSpan=null,this.gsmSpan=null,this.gnssSpan=null,this.velocityDiv=null,this.velocityImg=null,this.courseDiv=null,this.courseImg=null,this.timeDiv=null,this.addressDiv=null,this.trackDiv=null,this.historyDiv=null},bindPanelDivEvents:function(){$(this.addressDiv).click(function(){alert("详细地址")}),$(this.trackDiv).click(function(){alert("跟踪")}),$(this.historyDiv).click(function(){alert("历史数据")})},onConnectHost:function(){this.wegt02a&&(this.wegt02a.titleDiv.style.color="#000",this.wegt02a.socket.emit("setimei",this.wegt02a.imei))},onDisconnectHost:function(){this.wegt02a&&(this.wegt02a.titleDiv.style.color="#ccc")},onMessage:function(a){},onUpdatePVT:function(a){a&&this.wegt02a.map&&(this.wegt02a.sensor.pvt=a,this.wegt02a.updatePVT(a))},onUpdatePGG:function(a){a&&this.wegt02a.map&&(this.wegt02a.sensor.pgg=a,this.wegt02a.updatePGG(a))},updatePVT:function(a){this.lonlat.lon=a.lon,this.lonlat.lat=a.lat,this.updatePosition();if(!this.popup.visible())return;var b=0;this.velocityImg.width>0&&this.velocityImg.height>0&&(a.v<=0?b=-135:a.v>=180?b=135:b=a.v*270/180-135,$("#"+this.velocityImg.id).rotate(b)),this.courseImg.width>0&&this.courseImg.height>0&&(a.c<=0?b=0:a.c>=360?b=0:b=a.c,$("#"+this.courseImg.id).rotate(b)),b=null;var c=new Date(a.t*1e3),d=c.getFullYear()+"-"+(c.getMonth()<10?"0"+(c.getMonth()+1):c.getMonth()+1)+"-"+(c.getDate()<10?"0"+c.getDate():c.getDate())+"<br/>"+(c.getHours()<10?"0"+c.getHours():c.getHours())+":"+(c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes())+":"+(c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds());this.timeDiv.innerHTML=d,c=null,d=null},updatePGG:function(a){if(!this.popup.visible())return;a.stpow<=0?$(this.powerSpan).sparkline([1,1],{type:"pie",sliceColors:["#ddd","#ddd"],offset:-90,width:16,height:16}):a.stpow>=6?$(this.powerSpan).sparkline([1,1],{type:"pie",sliceColors:["#090","#090"],offset:-90,width:16,height:16}):$(this.powerSpan).sparkline([a.stpow,6-a.stpow],{type:"pie",sliceColors:[a.stpow>2?"#090":"#f00","#ddd"],offset:-90,width:16,height:16}),a.stgsm<=0?$(this.gsmSpan).sparkline([1,1],{type:"pie",sliceColors:["#ddd","#ddd"],offset:-90,width:16,height:16}):a.stgsm>=4?$(this.gsmSpan).sparkline([1,1],{type:"pie",sliceColors:["#090","#090"],offset:-90,width:16,height:16}):$(this.gsmSpan).sparkline([a.stgsm,4-a.stgsm],{type:"pie",sliceColors:[a.stgsm>1?"#090":"#f00","#ddd"],offset:-90,width:16,height:16}),a.nsate<=0?$(this.gnssSpan).sparkline([1,1],{type:"pie",sliceColors:["#ddd","#ddd"],offset:-90,width:16,height:16}):a.nsate>=12?$(this.gnssSpan).sparkline([1,1],{type:"pie",sliceColors:["#090","#090"],offset:-90,width:16,height:16}):$(this.gnssSpan).sparkline([a.nsate,12-a.nsate],{type:"pie",sliceColors:[a.nsate>3?"#090":"#f00","#ddd"],offset:-90,width:16,height:16})},onShowPopup:function(){this.sensor.pvt&&this.updatePVT(this.sensor.pvt),this.sensor.pgg&&this.updatePGG(this.sensor.pgg)},CLASS_NAME:"OpenLayers.WeSensor.WeGT02A"}),OpenLayers.Layer.WeBaidu=OpenLayers.Class(OpenLayers.Layer.XYZ,{attribution:"&copy; 2011 Baidu - GS(2011)6006号 - Data &copy; <a href='http://www.navinfo.com.cn/'>NavInfo</a> &amp; <a href='http://www.cennavi.com.cn'>CenNavi</a>",sphericalMercator:!0,wrapDateLine:!0,url:["http://q1.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q2.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q3.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q4.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q5.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q6.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q7.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44","http://q8.baidu.com/it/u=x=${x};y=${y};z=${z};v=006;type=web&fm=44"],initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeBaidu_name")},getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=17-(this.map.getZoom()+this.zoomOffset),f=Math.pow(2,e);this.wrapDateLine&&(c=(c%f+f)%f);var g=this.url,h=""+c+d+e;g instanceof Array&&(g=this.selectUrl(h,g));var i=OpenLayers.String.format(g,{x:c,y:d,z:e});return i},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeBaidu(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeBaidu"}),OpenLayers.Control.WeTaskbar=OpenLayers.Class(OpenLayers.Control,{CLASS_NAME:"OpenLayers.Control.WeTaskbar"}),OpenLayers.Layer.WeWXTiles=OpenLayers.Class(OpenLayers.Layer.TMS,{isBaseLayer:!1,visibility:!1,wrapDateLine:!0,legend:null,legendImage:null,strUTC:null,initialize:function(a,b,c){OpenLayers.Layer.TMS.prototype.initialize.apply(this,arguments),this.attribution="Weather Data by <a href='http://www.wxtiles.com/' target='_blank'>WXTiles</a>",this.strUTC=this.getUTCTime(),this.events.register("visibilitychanged",this,this.onVisibilityChanged)},destroy:function(){this.legend&&(this.legend.close(),this.legend=null),OpenLayers.Layer.TMS.prototype.destroy.apply(this,arguments)},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXTiles(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.TMS.prototype.clone.apply(this,[a]),a},getURL:function(a){var b=this.map.getResolution(),c=this.map.getZoom(),d=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),e=Math.pow(2,c);d=(d%e+e)%e;var f=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));return this.url+this.strUTC+"/"+c+"/"+d+"/"+f+".png"},getUTCTime:function(){var a,b,c,d,e;return a=new Date,a.setTime(a.getTime()+216e5),b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=a.getUTCDate(),e=a.getUTCHours(),e-=e%6,""+b+this.zer0(c)+this.zer0(d)+"_"+this.zer0(e)+"z"},zer0:function(a){return String(a).length<2&&(a="0"+a),a},onVisibilityChanged:function(a){this.getVisibility()?this.legendImage!=null&&typeof Weiran!="undefined"&&typeof Weiran.theOS!="undefined"&&(this.legend=Weiran.theOS.getManager().createWindow({title:this.name+": UTC "+this.strUTC,width:375,height:100,alwaysOnTop:!0,iconImageURL:"http://www.wxtiles.com/images/wxtiles_48.png"}),this.legend.setContent("<img src='"+this.url+this.legendImage+"' />"+"<a href='http://www.wxtiles.com' target='_blank'><img src='http://www.wxtiles.com/images/wxtiles_48.png' /></a>")):this.legend!=null&&(this.legend.close(),this.legend=null)},CLASS_NAME:"OpenLayers.Layer.WeWXTiles"}),OpenLayers.Layer.WeWXRain=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXRain_name"),this.url=b?b:"http://64.150.181.142/wx/rain/",this.legendImage="rain_small_horiz.png"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXRain(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeWXRain"}),OpenLayers.Layer.WeWXWind=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXWind_name"),this.url=b?b:"http://64.150.181.142/wx/wind/",this.legendImage="wind_small_horiz.png"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXWind(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeWXWind"}),OpenLayers.Layer.WeWXTemperature=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXTemperature_name"),this.url=b?b:"http://64.150.181.142/wx/tmp/",this.legendImage="tmp_small_horiz.png"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXTemperature(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeWXTemperature"}),OpenLayers.Layer.WeWXWaveHeight=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXWaveHeight_name"),this.url=b?b:"http://64.150.181.142/wx/hs/",this.legendImage="hs_small_horiz.png"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXWaveHeight(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},CLASS_NAME:"OpenLayers.Layer.WeWXWaveHeight"}),OpenLayers.Layer.WeWXCloudIR=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXCloudIR_name"),this.url=b?b:"http://74.208.230.214/sat/satir/"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXCloudIR(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},getUTCTime:function(){var a,b,c,d,e;return a=new Date,b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=a.getUTCDate(),e=a.getUTCHours(),e-=e%6,""+b+this.zer0(c)+this.zer0(d)+"_"+this.zer0(e)+"z"},CLASS_NAME:"OpenLayers.Layer.WeWXCloudIR"}),OpenLayers.Layer.WeWXCloudVisible=OpenLayers.Class(OpenLayers.Layer.WeWXTiles,{initialize:function(a,b,c){OpenLayers.Layer.WeWXTiles.prototype.initialize.apply(this,arguments),this.name=a?a:OpenLayers.i18n("WeWXCloudVisible_name"),this.url=b?b:"http://74.208.230.214/sat/satvis/"},clone:function(a){return a==null&&(a=new OpenLayers.Layer.WeWXCloudVisible(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.WeWXTiles.prototype.clone.apply(this,[a]),a},getUTCTime:function(){var a,b,c,d,e;return a=new Date,b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=a.getUTCDate(),e=a.getUTCHours(),e-=e%6,""+b+this.zer0(c)+this.zer0(d)+"_"+this.zer0(e)+"z"},CLASS_NAME:"OpenLayers.Layer.WeWXCloudVisible"}),OpenLayers.Control.WeMainPanel=OpenLayers.Class(OpenLayers.Control,{mainDiv:null,window:null,windowOpened:!1,apps:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.title=OpenLayers.i18n("WeMainPanel_title"),this.apps=[]},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.mainDiv=document.createElement("div"),this.mainDiv.className="olControlWeMainPanelContent",OpenLayers.Event.observe(this.div,"click",OpenLayers.Function.bindAsEventListener(this.onClick,this)),this.div},destroy:function(){if(this.apps){for(var a=this.apps.length-1;a>=0;a--)this.delApp(this.apps[a]),this.apps[a].destroy();this.apps=null}this.windowOpened&&(this.window.close(),this.window=null,this.windowOpened=!1),this.mainDiv&&(this.mainDiv=null),OpenLayers.Event.stopObservingElement(this.div),OpenLayers.Control.prototype.destroy.apply(this)},onClick:function(a){if(typeof Weiran!="object")return;var b=Weiran.theOS.getManager();this.windowOpened?this.window.select():(this.window=b.createWindow({title:this.title,centered:!0,width:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_ww")):null,height:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wh")):null,x:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wx")):null,y:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_wy")):null,state:$&&$.cookies&&$.md5?$.cookies.get($.md5(this.title+"_ws")):"window",iconImageURL:OpenLayers.ImgPath+"main_icon.png"}),this.window.getComponent("content").innerHTML="",this.window.getComponent("content").appendChild(this.mainDiv),this.windowOpened=!0,this.skipMapEvents(),this.window.onclose=this.onClose(this),this.window.onmove=this.onMove(this),this.window.onresize=this.onResize(this)),a!=null&&OpenLayers.Event.stop(a)},onClose:function(a){return function(){a.windowOpened=!1,a.window=null}},onMove:function(a){return function(b,c){if($&&$.cookies&&$.md5){var d={expiresAt:new Date(2099,12,31)};$.cookies.set($.md5(a.title+"_wx"),b+"",d),$.cookies.set($.md5(a.title+"_wy"),c+"",d)}}},onResize:function(a){return function(b,c,d){if($&&$.cookies&&$.md5){var e={expiresAt:new Date(2099,12,31)};switch(d){case"resize":$.cookies.set($.md5(a.title+"_ww"),b+"",e),$.cookies.set($.md5(a.title+"_wh"),c+"",e);break;case"maximize":$.cookies.set($.md5(a.title+"_ws"),"maximized",e);break;case"restore":$.cookies.set($.md5(a.title+"_ws"),"window",e)}}}},skipMapEvents:function(){if(this.window instanceof jwim.Window){var a=this.window.getComponent("window");OpenLayers.Event.observe(a,"mousedown",OpenLayers.Function.bindAsEventListener(this._stopEvents,this)),OpenLayers.Event.observe(a,"click",OpenLayers.Function.bindAsEventListener(this._stopEvents,this)),OpenLayers.Event.observe(a,"dblclick",OpenLayers.Function.bindAsEventListener(this._stopEvents,this))}},_stopEvents:function(a){OpenLayers.Event.stop(a,!0)},addApp:function(a){a instanceof Weiran.App&&(this.apps.push(a),this.mainDiv.appendChild(a.draw()))},delApp:function(a){a instanceof Weiran.App&&(this.mainDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.apps,a),a.active&&a.window&&(a.window.close(),a.window=null,a.active=!1))},clearApps:function(){if(this.apps){for(var a=this.apps.length-1;a>=0;a--)this.delApp(this.apps[a]),this.apps[a].destroy();this.apps=[]}},getAllApps:function(){return this.apps},CLASS_NAME:"OpenLayers.Control.WeMainPanel"});