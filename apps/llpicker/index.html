<!DOCTYPE html>
<html>
<head>
<title>LLPicker</title>
<meta charset=utf-8>
<script src=http://weapp.googlecode.com/svn/api/weapp.min.js></script>
<style type=text/css>body{font-size:smaller}label:hover{cursor:pointer;text-decoration:underline}#lonlat{margin-top:5px;width:95%}#locate{margin-top:5px;width:95%;text-align:center}</style>
<script>WeApp.LLPicker=top.Weiran.Class(WeApp,{layer:null,initialize:function(a){WeApp.prototype.initialize.apply(this,arguments);this.i18n();top.jQuery("#fromLabel",document).text(top.Weiran.i18n(this.CLASS_NAME+"_fromMap"));top.jQuery("#toLabel",document).text(top.Weiran.i18n(this.CLASS_NAME+"_toMap"));top.jQuery("#locate",document).val(top.Weiran.i18n(this.CLASS_NAME+"_locate"))},run:function(){WeApp.prototype.run.apply(this,arguments);this.layer=new top.OpenLayers.Layer.Vector(this.getTitle());this.getMap().addLayer(this.layer);top.jQuery("#fromMap",document).change(top.Weiran.Function.bind(this.onFromMap,this));top.jQuery("#toMap",document).change(top.Weiran.Function.bind(this.onToMap,this));top.jQuery("#locate",document).click(top.Weiran.Function.bind(this.onLocate,this));this.onFromMap()},i18n:function(){top.Weiran.Lang.add("en",this.CLASS_NAME+"_fromMap","Get a lonlat by clicking map");top.Weiran.Lang.add("en",this.CLASS_NAME+"_toMap","Type a lonlat to locate on map");top.Weiran.Lang.add("en",this.CLASS_NAME+"_locate","Locate this lonlat");top.Weiran.Lang.add("zh-CN",this.CLASS_NAME+"_fromMap","点击地图获取经纬度");top.Weiran.Lang.add("zh-CN",this.CLASS_NAME+"_toMap","输入经纬度并在地图上显示");top.Weiran.Lang.add("zh-CN",this.CLASS_NAME+"_locate","定位此坐标")},onFromMap:function(a){if(top.jQuery("#fromMap",document).attr("checked")){top.jQuery("#lonlat",document).attr("readonly","readonly");top.jQuery("#locate",document).attr("disabled","disabled");this.getMap().events.register("click",this,this.onPick);this.getMap().viewPortDiv.style.cursor="crosshair";this.layer.removeAllFeatures()}},onToMap:function(a){if(top.jQuery("#toMap",document).attr("checked")){top.jQuery("#lonlat",document).removeAttr("readonly");top.jQuery("#locate",document).removeAttr("disabled");this.getMap().events.unregister("click",this,this.onPick);this.getMap().viewPortDiv.style.cursor="default";this.layer.removeAllFeatures()}},onLocate:function(a){var b=top.OpenLayers.LonLat.fromString(top.jQuery("#lonlat",document).val()).transform(this.getMap().displayProjection,this.getMap().getProjectionObject());this.layer.removeAllFeatures();this.layer.addFeatures([new top.OpenLayers.Feature.Vector(new top.OpenLayers.Geometry.Point(b.lon,b.lat),{},{graphicName:"cross",strokeColor:"red",strokeWidth:2,fillOpacity:0,pointRadius:10})]);this.getMap().setCenter(b)},onPick:function(c){if(!this.theWin.isSelected()){return}var b=this.getMap();var d=b.getLonLatFromPixel(c.xy);var a=d.clone();var d=d.transform(b.getProjectionObject(),b.displayProjection);top.jQuery("#lonlat",document).val(d.lon.toFixed(6)+", "+d.lat.toFixed(6));this.layer.removeAllFeatures();this.layer.addFeatures([new top.OpenLayers.Feature.Vector(new top.OpenLayers.Geometry.Point(a.lon,a.lat),{},{graphicName:"cross",strokeColor:"red",strokeWidth:2,fillOpacity:0,pointRadius:10})])},destroy:function(){this.getMap().removeLayer(this.layer);this.layer.destroy();this.layer=null;this.getMap().events.unregister("click",this,this.onPick);this.getMap().viewPortDiv.style.cursor="default";WeApp.prototype.destroy.apply(this,arguments)},onSelect:function(){WeApp.prototype.onSelect.apply(this,arguments);if(top.jQuery("#fromMap",document).attr("checked")){this.getMap().viewPortDiv.style.cursor="crosshair"}},onDeselect:function(){WeApp.prototype.onDeselect.apply(this,arguments);if(top.jQuery("#fromMap",document).attr("checked")){this.getMap().viewPortDiv.style.cursor="default"}},onIconize:function(){WeApp.prototype.onIconize.apply(this,arguments);if(top.jQuery("#fromMap",document).attr("checked")){this.getMap().viewPortDiv.style.cursor="default"}},CLASS_NAME:"WeApp.LLPicker"});</script>
</head>
<body>
<input type=radio name=method id=fromMap checked=checked />
<label for=fromMap id=fromLabel>From map</label>
<br />
<input type=radio name=method id=toMap />
<label for=toMap id=toLabel>To map</label>
<br />
<input type=text id=lonlat value="0.000000, 0.000000" readonly=readonly />
<br />
<input type=button id=locate value=Locate disabled=disabled />
<script>var app=new WeApp.LLPicker();app.run();</script>
</body>
</html>
